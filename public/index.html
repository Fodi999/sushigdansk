<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sushi Delivery Gdansk</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/images/site.webmanifest">
    <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="preload" href="/css/app.css" as="style">
    <link rel="preload" href="/images/Rectangle-3.webp" as="image">
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
    <meta name="description" content="Best sushi delivery in Gdansk. Order now and enjoy fresh sushi at home!">
    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    
    <meta name="apple-mobile-web-app-status-bar-style" content="white">
</head>
<body>
    <!-- Хедер с логотипом и текстом -->
    <header class="header">
        <img src="images/feis-1.webp" alt="Logo" class="logo">
        <h1 class="header-text">Sea food from chef Dmitry Fomin</h1>
    </header>

    <main class="main-content">
        <!-- Название первого ряда -->
        <div class="section-title-box">
            <h2 class="section-title"><i class='bx bxs-right-arrow'></i> Суши</h2>
        </div>
        <div class="card-container" id="card-container-row-1">
            <!-- Карточки первого ряда будут добавлены здесь динамически с помощью JavaScript -->
        </div>

        <!-- Название второго ряда -->
        <div class="section-title-box">
            <h2 class="section-title"><i class='bx bxs-right-arrow'></i> Роллы</h2>
        </div>
        <div class="card-container" id="card-container-row-2">
            <!-- Карточки второго ряда будут добавлены здесь динамически с помощью JavaScript -->
        </div>

        <!-- Название третьего ряда -->
        <div class="section-title-box">
            <h2 class="section-title"><i class='bx bxs-right-arrow'></i> Сеты</h2>
        </div>
        <div class="card-container" id="card-container-row-3">
            <!-- Карточки третьего ряда будут добавлены здесь динамически с помощью JavaScript -->
        </div>

        <!-- Название четвертого ряда -->
        <div class="section-title-box">
            <h2 class="section-title"><i class='bx bxs-right-arrow'></i> Закуски</h2>
        </div>
        <div class="card-container" id="card-container-row-4">
            <!-- Карточки четвертого ряда будут добавлены здесь динамически с помощью JavaScript -->
        </div>
    </main>

    <!-- Неподвижное меню -->
    <div class="navigation">
        <ul>
            <li class="list active" id="cart-button">
                <a href="#" aria-label="Cart">
                    <span class="icon"><ion-icon name="cart-outline"></ion-icon></span>
                    <span class="text">Корзина</span>
                </a>
            </li>
            <li class="list">
                <a href="#" aria-label="Account">
                    <span class="icon"><ion-icon name="person-outline"></ion-icon></span>
                    <span class="text">Кабинет</span>
                </a>
            </li>
            <li class="list" id="delivery-button">
                <a href="#" aria-label="Delivery">
                    <span class="icon"><ion-icon name="bicycle-outline"></ion-icon></span>
                    <span class="text">Доставка</span>
                </a>
            </li>
            <li class="list">
                <a href="#" aria-label="Sushi">
                    <span class="icon"><ion-icon name="fast-food-outline"></ion-icon></span>
                    <span class="text">Суши</span>
                </a>
            </li>
            <li class="list">
                <a href="#" aria-label="Chat">
                    <span class="icon"><ion-icon name="chatbubble-outline"></ion-icon></span>
                    <span class="text">Чат</span>
                </a>
            </li>
        </ul>
        <div class="indicator"></div>
    </div>

<!-- Модальное окно чата -->
<div id="chat-modal" class="modal">
    <div class="modal-content">
        <!-- Кнопка для закрытия модального окна -->
        <span class="close-button" id="close-chat-modal">&times;</span>
        <h2>Чат</h2>
        
        <!-- Контейнер для сообщений чата -->
        <div id="chat-content" style="max-height: 400px; overflow-y: auto; padding: 10px;">
            <!-- Сюда будут добавляться сообщения из Telegram -->
            <div id="chatMessages" class="chat-messages-container"></div>

        </div>
       
    </div>
</div>



    <!-- Модальное окно корзины -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-modal">&times;</span>
            <h2 class="cart-header">Корзина</h2>
            <div id="cart-items">
                <!-- Пример карточек товаров -->
                <div class="cart-item">
                    <button class="remove-button">&times;</button>
                    <img src="images/Rectangle-3.webp" alt="Product Image" width="100" height="100">
                    <div class="item-details">
                        <h3>Название товара</h3>
                        <p>Описание товара</p>
                        <p class="item-quantity">Количество: 1</p>
                    </div>
                </div>
                <!-- Здесь будут добавляться другие карточки товаров -->
            </div>
            <button id="checkout-button" class="order-button">Сделать заказ</button>
        </div>
    </div>

    <!-- Модальное окно оформления заказа -->
    <div id="checkout-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-checkout-modal">&times;</span>
            <h2>Оформление заказа</h2>
            <form id="checkout-form">
                <label for="name">Имя:</label>
                <input type="text" id="name" name="name" required>
                <label for="address">Адрес:</label>
                <input type="text" id="address" name="address" required>
                <label for="phone">Телефон:</label>
                <input type="tel" id="phone" name="phone" required>
                <label for="additionalInfo">Дополнительная информация:</label>
                <textarea id="additionalInfo" name="additionalInfo"></textarea>
                <button type="submit" class="order-button">Отправить</button>
            </form>
        </div>
    </div>

    <!-- Модальное окно доставки -->
    <div id="delivery-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-delivery-modal">&times;</span>
            <h2>Доставка</h2>
            <div id="delivery-map" style="height: 300px; width: 100%;">
                <!-- Здесь будет карта -->
            </div>
            <p>Время доставки: 30-45 минут</p>
        </div>
    </div>

    <!-- Контейнер для всплывающих уведомлений -->
    <div id="log-messages" class="log-container"></div>

    <!-- Скрипты -->
    <script type="module" src="/js/main.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>


    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io();
        
            // Загрузка истории сообщений при подключении
            socket.on('chat history', function (messages) {
                messages.forEach(message => {
                    addMessageToChat(message);
                });
            });
        
            // Слушаем событие добавления сообщений в чат
            socket.on('chat message', function (msg) {
                addMessageToChat(msg);
            });
        
            // Слушаем событие обновления лайков
            socket.on('like update', function ({ id, likes }) {
                const likeButton = document.querySelector(`.like-button[data-id="${id}"]`);
                if (likeButton) {
                    likeButton.textContent = `👍 ${likes}`;
                }
            });
        
            // Функция для добавления сообщения в чат
            function addMessageToChat({ _id, text, imageUrl, likes }) {
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    // Создаем карточку сообщения
                    const messageCard = document.createElement('div');
                    messageCard.className = 'message-card';
        
                    // Добавляем текст сообщения
                    if (text) {
                        const messageText = document.createElement('div');
                        messageText.className = 'message-text';
                        messageText.textContent = text;
                        messageCard.appendChild(messageText);
                    }
        
                    // Добавляем изображение, если оно есть
                    if (imageUrl) {
                        const messageImage = document.createElement('img');
                        messageImage.className = 'message-image';
                        messageImage.src = imageUrl;  // Устанавливаем URL изображения
                        messageCard.appendChild(messageImage);
                    }
        
                    // Добавляем отметку времени
                    const messageTimestamp = document.createElement('div');
                    messageTimestamp.className = 'message-timestamp';
                    messageTimestamp.textContent = new Date().toLocaleTimeString(); // Добавляем время
                    messageCard.appendChild(messageTimestamp);
        
                    // Добавляем кнопку лайка
                    const likeButton = document.createElement('button');
                    likeButton.className = 'like-button';
                    likeButton.textContent = `👍 ${likes || 0}`;
                    likeButton.setAttribute('data-id', _id); // Привязка ID сообщения к кнопке
                    likeButton.addEventListener('click', () => likeMessage(_id, likeButton));
                    messageCard.appendChild(likeButton);
        
                    // Добавляем карточку в контейнер сообщений
                    chatMessages.appendChild(messageCard);
                } else {
                    console.error("Элемент #chatMessages не найден на странице.");
                }
            }
        
            // Функция для обработки лайков
            async function likeMessage(messageId, likeButton) {
                try {
                    const response = await fetch(`/api/messages/${messageId}/like`, {
                        method: 'POST'
                    });
                    const data = await response.json();
                    likeButton.textContent = `👍 ${data.likes}`; // Обновляем количество лайков на кнопке
                } catch (error) {
                    console.error('Ошибка при отправке лайка:', error);
                }
            }
        });
        </script>
        
      


    
    
    
</body>
</html>
